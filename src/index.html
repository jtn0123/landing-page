<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>neuhard.dev — Engineering &amp; Software Projects</title>
  <meta name="description" content="Full-stack engineering projects by neuhard — interactive web apps, data systems, and more.">

  <!-- Open Graph -->
  <meta property="og:title" content="neuhard.dev — Projects">
  <meta property="og:description" content="Full-stack engineering projects — interactive web apps, data logging systems, and more.">
  <meta property="og:image" content="https://neuhard.dev/images/megabonk.png">
  <meta property="og:url" content="https://neuhard.dev/">
  <meta property="og:type" content="website">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="neuhard.dev — Projects">
  <meta name="twitter:description" content="Full-stack engineering projects — interactive web apps, data logging systems, and more.">
  <meta name="twitter:image" content="https://neuhard.dev/images/megabonk.png">

  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to content</a>

  <header id="site-header">
    <h1>neuhard.dev</h1>
    <p>Engineering &amp; Software Projects</p>
  </header>

  <main id="main-content" class="projects">
    <article class="card fade-in" tabindex="0" data-link="https://neuhard.dev/megabonk/">
      <div class="card-img">
        <picture>
          <source srcset="images/megabonk.webp" type="image/webp">
          <img src="images/megabonk.png" alt="MegaBonk screenshot" loading="lazy" class="lightbox-trigger">
        </picture>
      </div>
      <div class="card-body">
        <h2>MegaBonk</h2>
        <p class="desc">The ultimate reference guide for MegaBonk — items, weapons, tomes, characters, shrines, build planner, and breakpoint calculator in one interactive web app.</p>
        <div class="tech">
          <span>TypeScript</span>
          <span>Vite</span>
          <span>Playwright</span>
          <span>Chart.js</span>
        </div>
        <div class="buttons">
          <a href="https://neuhard.dev/megabonk/" class="btn btn-primary">Live App</a>
          <a href="https://github.com/jtn0123/MegaBonk" class="btn">GitHub</a>
        </div>
      </div>
    </article>

    <article class="card fade-in" tabindex="0" data-link="https://neuhard.dev/volttracker/" style="--fade-delay: 200ms">
      <div class="card-img">
        <picture>
          <source srcset="images/volttracker.webp" type="image/webp">
          <img src="images/volttracker.png" alt="VoltTracker dashboard" loading="lazy" class="lightbox-trigger">
        </picture>
      </div>
      <div class="card-body">
        <h2>VoltTracker</h2>
        <p class="desc">Self-hosted data logging and analysis system for the Chevy Volt. Receives OBD-II telemetry from Torque Pro, tracks fuel efficiency, battery health, and charging analytics.</p>
        <div class="tech">
          <span>Python</span>
          <span>Flask</span>
          <span>PostgreSQL</span>
          <span>TimescaleDB</span>
          <span>Redis</span>
          <span>Docker</span>
          <span>TypeScript</span>
        </div>
        <div class="buttons">
          <a href="https://neuhard.dev/volttracker/" class="btn btn-primary">Live App</a>
          <a href="https://github.com/jtn0123/VoltTracker" class="btn">GitHub</a>
        </div>
      </div>
    </article>
  </main>

  <!-- Recent Activity Timeline -->
  <section id="activity" class="timeline-section">
    <h2>Recent Activity</h2>
    <div id="timeline" class="timeline">
      <div class="timeline-loading">
        <div class="skeleton-item"></div>
        <div class="skeleton-item"></div>
        <div class="skeleton-item"></div>
      </div>
    </div>
  </section>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-label="Image preview">
    <img id="lightbox-img" src="" alt="">
  </div>

  <footer>v2.0.0 · © 2026 neuhard.dev</footer>

  <script>
    // --- Sticky header ---
    const header = document.getElementById('site-header');
    let lastScroll = 0;
    window.addEventListener('scroll', () => {
      header.classList.toggle('scrolled', window.scrollY > 40);
    }, { passive: true });

    // --- Fade-in on scroll ---
    const fadeEls = document.querySelectorAll('.fade-in');
    const fadeObserver = new IntersectionObserver((entries) => {
      entries.forEach(e => {
        if (e.isIntersecting) {
          e.target.classList.add('visible');
          fadeObserver.unobserve(e.target);
        }
      });
    }, { threshold: 0.15 });
    fadeEls.forEach(el => fadeObserver.observe(el));

    // --- Keyboard nav for cards ---
    document.querySelectorAll('.card[data-link]').forEach(card => {
      card.addEventListener('keydown', e => {
        if (e.key === 'Enter') {
          const link = card.querySelector('.btn-primary');
          if (link) link.click();
        }
      });
    });

    // --- Lightbox ---
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightbox-img');
    document.querySelectorAll('.lightbox-trigger').forEach(img => {
      img.style.cursor = 'zoom-in';
      img.addEventListener('click', e => {
        e.preventDefault();
        e.stopPropagation();
        lightboxImg.src = img.src;
        lightboxImg.alt = img.alt;
        lightbox.classList.add('active');
      });
    });
    lightbox.addEventListener('click', () => lightbox.classList.remove('active'));
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') lightbox.classList.remove('active');
    });

    // --- Commit Timeline ---
    (async function loadTimeline() {
      const timelineEl = document.getElementById('timeline');
      const cacheKey = 'neuhard_commits';
      const cacheTTL = 5 * 60 * 1000; // 5 min

      function relativeTime(dateStr) {
        const diff = Date.now() - new Date(dateStr).getTime();
        const mins = Math.floor(diff / 60000);
        if (mins < 1) return 'just now';
        if (mins < 60) return mins + 'm ago';
        const hrs = Math.floor(mins / 60);
        if (hrs < 24) return hrs + 'h ago';
        const days = Math.floor(hrs / 24);
        if (days < 30) return days + 'd ago';
        return Math.floor(days / 30) + 'mo ago';
      }

      function truncate(str, len) {
        return str.length > len ? str.slice(0, len) + '…' : str;
      }

      function renderTimeline(commits) {
        if (!commits.length) {
          timelineEl.innerHTML = '<p class="timeline-empty">No recent activity</p>';
          return;
        }
        timelineEl.innerHTML = '<div class="timeline-line"></div>' +
          commits.map((c, i) => `
            <div class="timeline-item ${i % 2 === 0 ? 'left' : 'right'}">
              <div class="timeline-dot"></div>
              <div class="timeline-content">
                <p class="commit-msg">${truncate(c.message.split('\n')[0], 60)}</p>
                <div class="commit-meta">
                  <span class="repo-badge repo-${c.repo.toLowerCase()}">${c.repo}</span>
                  ${c.additions != null ? `<span class="stat-add">+${c.additions}</span>` : ''}
                  ${c.deletions != null ? `<span class="stat-del">-${c.deletions}</span>` : ''}
                  <span class="commit-time">${relativeTime(c.date)}</span>
                </div>
              </div>
            </div>
          `).join('');
      }

      // Check cache
      try {
        const cached = JSON.parse(sessionStorage.getItem(cacheKey));
        if (cached && Date.now() - cached.ts < cacheTTL) {
          renderTimeline(cached.data);
          return;
        }
      } catch {}

      try {
        const [mbRes, vtRes] = await Promise.all([
          fetch('https://api.github.com/repos/jtn0123/MegaBonk/commits?per_page=5'),
          fetch('https://api.github.com/repos/jtn0123/VoltTracker/commits?per_page=5')
        ]);
        if (!mbRes.ok && !vtRes.ok) throw new Error('API failed');

        const parse = async (res, repo) => {
          if (!res.ok) return [];
          const data = await res.json();
          return data.map(c => ({
            message: c.commit.message,
            date: c.commit.committer.date,
            repo,
            url: c.html_url,
            sha: c.sha
          }));
        };

        const commits = [
          ...await parse(mbRes, 'MegaBonk'),
          ...await parse(vtRes, 'VoltTracker')
        ].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 10);

        // Fetch stats for each commit (fire all in parallel)
        await Promise.all(commits.map(async (c) => {
          try {
            const r = await fetch(`https://api.github.com/repos/jtn0123/${c.repo}/commits/${c.sha}`);
            if (r.ok) {
              const detail = await r.json();
              c.additions = detail.stats?.additions || 0;
              c.deletions = detail.stats?.deletions || 0;
            }
          } catch {}
        }));

        sessionStorage.setItem(cacheKey, JSON.stringify({ ts: Date.now(), data: commits }));
        renderTimeline(commits);
      } catch {
        timelineEl.innerHTML = '<p class="timeline-empty">Unable to load recent activity</p>';
      }
    })();
  </script>
</body>
</html>
